// RUN: byteir-opt -fuse-mhlo-to-cat --cse %s | FileCheck %s

func.func @test_gemm_bias_0(%arg0: tensor<2x2048xf32>, %arg1: tensor<2048x1001xf32>) -> tensor<2x1001xf32> {
    %0 = mhlo.constant dense<"0xF06693BCB160E6BB1C3F17BC7DBB03BC7FAEDFBC84B40E3B7CFC1ABCFC4B18BC66632B3B026C883BA7EBDFBB04244DBC0A6F04BB7B7E8EBC24CA07BC39E184BAF44168BC5544B7BAB27F41BCEF571E3C56F34ABC93B5243C92710F3CD8265DBC41EE273CAB28F33A234F15BBD630CF3B6F5DF3BB7585C1BB8E9880BC48A6EEBB31195BBCE6A126BBD80AA4BC9EA72D3BCBCAC9BCF45CB8B728EEFBBB98E8103B8719863AAC7A1A3BBC75873B330CFC3BCFB42CBC64F82F3BE71E803B4F84B53C450109BC646A67BC20CA59BB035E4E3CC5F890BC8C691C3C26B9C13B8E95213C51C09BBA453D873C9C0FBDBBFE03533CA32B8C3C5933713C7192273CE272093B36DDA73BFA9E073CB739043CB8D94ABCBA203A3C7B47CFBB64C9DABBFA8E6DBCFD3DA43B143284BBB97035BC9EFC6EBC8E10B93B2A4E9ABBBF3B693CD98AE43B9C00543CF4AA7FBC5DD7EF3B6442D73BD3E9C1BCADB9F2BB2CF5D73A8B4F97BBC8A8FF3B6A07ED3AF2CFB53B8492613A0E7D38BCE6AC973BDC53BC3BEE77C2BB49FF51BC398C0BBB8ACEF5BBD8C8A4BC909E81BB8B856CBC433B5EBC9A6BF4BBC507203BF9AAF03B9E842DBC696E9ABADB898FBC4314ABBCA639D3BC59583DBC55B9233B2CF00BBAF5D572BCC2B7B0BB96B5E0BC9A9D08BC146988BC4626393AC958A13A82496DBC23F216BC579A29BCF159CABB2E6D5B3CA8A8EABBDEE046BCCA5614BBBDBD92BC8262C0BB21934BBC4D17083B50F104BA6DEA67BBF55316BCA937B4BC8F638FBB48859CBC7743E6BBDB2376BC707023BC79F3D6BB64A889BC83BFD2BB7EB165BCA4DAADBB2AAD9FBB38C1C1BC217A29BCD5058BBC65AE833B1D604D3C542A82BCAF13993CD7DB4B3B8709DC3A35A92D3C33CF29BC35D755BCF799C5BBCA525DBB8E7C1C3CBCCE0D3DD7B2863C5DC1CDBA575667BC74429F3BFE8C84BCA772343B8249B0BB4344FB3B9CE19D3C6DF21C3CBA33C43B8BCB673A75C9F8BB9EF8BE3BF9C49CBAC566AD3C227A903AD7D3AABBBAF8833B65AC1B3CFED997BBF5A9243C59912B3C675D54BC229DF6BB3ED1D4BBE05ED03B885503BCD807B63CF12A893C3641EFBB7DF003BB9386033DE53CCF3BFF72DB3B702E5FBC0B494D3C1E5884BC784A383C5D146D3C4C62B83C35B0773C4E6CFB39D0F32EBC7C04783BE312913BC6E7A53CD00A07BC873F313C5066743B381828BCC676B5BBA567C5BA445001BCD18DE43CA478A93AE7F67EBAE89AE23A8B04A5BB9FA4903B14640D3DF17E63BCBF56F73CD08917B9FBC62E3C956E3CBCACBE0B3CFA156C3C67E351BCF0B6893CDED8143C91B9403C7263B03BC9D4453CCAF4413CE6777A3CC76EF03C5F954D3C3ED921BB20817DBA98ED03BA9667D2B8CF99503C29C5E0BB9329053C3DB3153B2871A7BBD5B4323C6290BD3CD2B234BCA196A4BCAB6F493CF6622ABAD38A643C26D5B23A79EFB73B2AFB2ABB50EDDC3BA453F6B990FB1C3A963AA43BC9DF78BB845029BCAFC2093C69A533B9AF494DBC07C45CBC9394873CC92693BC4FC7853BBF76063CB71234BB0ED774BCC022BA3B9C71623977C67CBC16E56B3AF62926BC7471DE3C08466FBBE56A7EBC15DF583CD8E1813C286A0DBC02AE42BBDC3F55BCE51498BB60F967BC652B81BC6CD5ADBAE69458BC804588BCCCA9363A337C0EBC5B5E4EBC342BFCBBDD72643C1ACD15BCC9E78DBB7510F9BBDD3CB1BB4B717ABC8F581F3C4D22483CBD6081BBC81086BC680C0ABCCA36453C1EC99FBB25B5D13A5072F53C2FA4A93C6FEC433B622678BBFF3259BC7586FF3ADC4238BB6D5744BCF9D65CBC1B3FC9BC6CADA3BC0C109ABC99EC22BC3385A5BCDFCF1FBC46D4FCBB2FA9FBBB95A6CD3AF9926ABC19BCE139B773C23B93079BBB2749C8BBC870453C8BD3A0BB76C0263BAC8E97BC92E9AFBB89099CBC0D28FCBB52AA61BB01886FBCF56BEABA7F21233C198E18BCEB95B53B841BC7BBFA33BCBB2BFB49BC517929BB5D26E5BA4BFD40BC8E2AA1BA5798203CA6DA43BC9E04523C0B120B3C154B4ABB5337823CBAE84B3C0B3A813BE0D039BC3B38BDBBD50DA3BC2628CF3BE4355BBC31D7213A775F82BB61A434BC969F2ABC716502BB6185E4BB14FBA4BB78F77EBC646025BCF663023CFA678E3B9DBE8DBC80290EBBC9523B3B95B92D3B69AFAABC1B0EE6BB65F4A83AB1182DBC929D9DBC71E944BB259C86BCF0F35C3C2729D2BC2B6EC2BCC2389CBBF0AD32BC6543D2BCF05AD3BBAE3EF8BAA8E598B9A56D3EBCB0EE813CC9D5E93A2F4C39BCF7A8CDBC5DFC93BAE32713BCB35CA8BA8B7B84BCC2D629BBE61B3E3B0F81E9BBF7F5A13C35B9F03B369AF03B13CA0A3C15A586BAEFBC073B424B563B9D0B833C362A7E3BB8A9963CFEFC893B8F9D843CC480983C51C6E53A8379A6BC608584BC013AC83CC662213B743AA1BC08714D3C7745283BF12548BA6E5B243BEDF9583B7B15C73B61B7C6BB4F8F81BB55EE42BB1022183CACD20D3B33CD833A719528BC81465BBA4D438E3CAC08A93C8A3E30BCC483813CB9A5FC39469B2639534F17BBAE351ABB7D6B343CC6D37E3C1B13553CEF88493CA2406E3CDF4882BCFF90933B07CB9C3BE63E3ABCFEFB183B6A86EF3CFC59763C2D2320BA974B44BCB913C7BA67682A3C693F3DB9D782083CD2A0253B0C8CBAB925B7673BD277A7BC3A20853A2C44BBBC8A4433BC1304793B7616D438EA93703C8CF285BB1645143A3A8DA8B97A510FBC95FA45BC6FA07C3BC232033D6EF96B3B82F0633C40E770BC2524E33B72A3033C693549BCCD8622BCE6BD36BB64888EBB150F49BCB3643EBB660703BCC9957CBC194854BC807C1A3CCB0CE6BB04FAC33A59E4B43AC1C3273C31CDF9BBCB992B3CFD036BBC98EF14BC8B64073C17B7343CDC0DD33BAF6086B98C68043D22DE9EBB414B8EBB1CC1E63A37EF403C1079AABC32DCF03BF9660C3CBD21EF3C475857BCE83B40BCCA403C3C4DC1233C4F97CA3A146C093C24DFA13CA8E22FBC06A0533B838533BCD945B43B4F713BBC77260C3A78499CBBAED018BB9066DD3C4325AABC1DCE543CCC5054BBAFFA343CB47C3EBBD349D7B990DB46BB2E3B90BC078D50BC54B597BC8E469F3B825A2EBB6E2DE3BA7DA14D3BA0AD6FBCCA1A833B0F0CB0BC7CC8AD3B8A3F6C3C824D493C62C46CBC914899BB5DE5053B0305383C4358F1BB36FC80BB534EE73AAA86803C6F4497BB68AED5BB35C753BC45B7B73BF804813C3A5B33BC00A6FC3A5ED3C83BB743273A4467B93B81849DB9B1005B3C7B4E963B69EA32BCE1A1003CC82E81BB540288BA3D0DB0BB86A326BC0167BF3CB6A563391DD5143B74E85DBCD758C0BA759251BB61550B3CDF96903B59DCF8BB3C63373CEEAC183C200119BCAD4E053CA655A63C7656E0BA247DB436B5B7253B689570BC238BF23BEC6B20BB5EBF823BA2B1773C39F0C6BBF7682E3C21CBB8BBDE540BBC68AFAA3AE51731BB4A601DBCF780BF3BAF80C13A3A9E783C95070BBC8439DF3C73898E3CDEF74C3CF503BB3C932C6B3C812417BC480A973C5B0B983CB0493EBB865A6ABB670592BB373BD1BBCE69383C316DD43B423E0ABB1E562CBC3BCEEE3B9B14A2BBC3AA373CDC3AA0BCBACE79BCFD24F8B9D5E7C83BBA17343B2300993C90BC64BC6BB5363C84C55FBC5C6A963B5F04263C53EFC83C8DB134394CBA7A3CFCB7843BC3E9083CEEA2C83CCC112C3BD342803C182B163B21964B3CFDAA1EBB96AA4FBCA36B5D3CC98CBC3925757D3C25F71D3CB0CF633CBE5CD73B1F548ABC25CACDBC1AC015BB9757293CECDF843BCBAC1C3C6287F93B675793BCEF70DC3BE445FE3BB484AC3B47DF243C6E5DF6BB19E0D23CC6E42DBBB3EA813CAD14133BE45570BCE4A87DBBD5F2D2BC135080BC8041A2BC117079BCB289D4BB0250753CF4D6E9BB489A7FBC179A253C2EBBA13BEE22E7BAFF6372BC5F7B3F3BE5B2093D5C2E9FBB343347BB27C9783B208A913BD7C8173C4534433C0D5101BC866BD73B6E7E1ABB344449BC85B9413CE9CC45BC9BE5C23BB46190BB90B05CBCE5831F3DB6FF4CBCE38B2A3CA2CF873C8E29A0BBBB29483C09DE8E3C7F3138BCDC6470BC9F1D113C75C96FBB92F076BCD9870EBCF5DE58BBD06A86BB3208CC3CD177DE3B7ABC523CBC5231BCA124B43B24CD983BA9D3AE3AB1ED0C3C411A28BC88A1E6BB036E52BC9128203C0705EB3CE095933C7260C43B987E74BC158EFBBA620ABABBE11B063D1DEF033C3B70CFBB93567C3CF9C7293C5763C93A480581BC1585473CA21DC7BAE6ABA4BBF86BB13B743E343C1A60833CCA83853C83B8D4BA861FA33CCB9FFC3B90AD21BB50C8853857FDDF3BC9BA8E3C819BFABB7D6B03BCA0FED73B3D6C073CD102683C979C11BCA372243CC0AF2C3B1EF4023CAA2D0CBC026B80BCBF5657BC81E6BDBA65D9E2BB10B5353C1603923CC2B03ABA080ECBBBA8EC743B357217BBA5978EBC6DFCB63C3CAFA93C3E827EBB849B60BC1487A2BCAB9BC9BB22F0303C856484BCEBE1C93C155FCBBC381D293BE6D894BC83C169BC98F2C0BBB931FD3CE1792BBC915BBBBB64DC813C378BD0BB71C949BCE104CBBBF3B8FDBAB90A573C9A674EBCA225763BC097073C388824BCBD0CB2BA8F4CD23B5AFC87BC2D768FBC221024BAC2AF8F3C26D2BE3B4A6DF63B6C56CEBBCE5DC43A6075CC3CD7FF96BCCACDD93B7F7AE33A51C8A4BB06E194BBDB44B23CFCB51CBC27A9123CD600D63CA348A03B87C4C7399CF5CF3C3997393ABE266C3C3616FF3B97615D3BFA8FF73C3351153A5518BC3A4D86FA3B27E398BAEECE7A3CBC9F003C7379023C0F8F42BCCE438CBCBC1FAA3A3509D0BC85E93ABCC225923A83C5053C004070BC98C1B63C8131AABBB329CDBA1C6CA8B96F25F2BBA985C3BA55E40FBC4AD99E3CDA7F79BB6176583CA021A5BB721DA13CADDC13BCAC9506BD1FE7A03B9BB2E13C9A8F94BAAB0377BC1D63EE3CEB37D33CE2A2FD3B041DCD3B8BD9CD3B6965B9BBE778E23B9C6B4ABCF52C49BC0D95B33AB88D583BF1BF9FBA8C328BBC9B911D3CFC7B95BB598AD4BB6A7178BB21EA323C750D803C2F5BBB3C0B914E3CF09512BC09BB00BC0887BC3C5298CF3C65C30CB91259F1BAC89DC83BCDEED03CEB4FABBB1C80853CAFC5C13C7A08643C6D314A3C4D2F363C3C3B92BCCA1E46BCD331A3BCCBFC67BC31F2E13BF569563CBF81083CBD8F2A3C5304ADBC47C82B3A947FF7BC8BE030BCA1C29BBCCAC55BBC328950BACC76033DB3F04C3BF5349EBB67C8ECBBB33887BC2A75DD3A145A4EBB2D9F0E3C9A6051BCBD2C15BC2987D9393F5F2D3B80BE90BBD4F492BC12FF33BCB5079639BA165BBBE855D5BB1EECABBB44C9BEBBBCDB0A3AD165AC3BF9CB1DBB3AABD6BB857C06BCCAF98E3BD8F567BC5BE2DBBB9307D3BB270DB93B9740CABCB105F5BBB96E543B2DF305BCEE706DBC6932B9BC4AA8B5BB1AC27D3C19B3EF3BEE59923C5615813BC66AB9BB0AB7853C0867423CE52B3B3C003ED5BB1513BE3C2E3A473CADC6FF3C6E4DF33B787144BBFE49463CFF153F3A67759B3CC9B110BC1DCF383CBD15C2BB53D10DBCFCC3983C29E161BAF407E1BB19568CBB890C54BCC14B5DBCC21102BD8E55F7BB3040CEBB46CF293B25EBBBBB52DD5C3C7975983C"> : tensor<1001xf32>
    %1 = "mhlo.dot"(%arg0, %arg1) : (tensor<2x2048xf32>, tensor<2048x1001xf32>) -> tensor<2x1001xf32>
    %2 = "mhlo.broadcast_in_dim"(%0) {broadcast_dimensions = dense<1> : tensor<1xi64>} : (tensor<1001xf32>) -> tensor<2x1001xf32>
    %3 = mhlo.add %1, %2 : tensor<2x1001xf32>
    return %3 : tensor<2x1001xf32>
}

// CHECK: func.func
// CHECK-NEXT: mhlo.constant
// CHECK-NEXT: cat.gemm_bias

func.func @test_conv_bias(%arg0: tensor<2x28x28x256xf32>, %arg1: tensor<256x3x3x256xf32>) -> tensor<2x14x14x256xf32> {
    %0 = mhlo.constant dense<"0x0C9154BF7882333F182A763E30881DBFC1C5D73E636E89BF707124BF5DAB5DBF1DCA2F3F70C5C43DD5F2463F2750B93EE4E43A3F0A40273F24F62B3FA0D0BD3BC03AAF3EE649D93D2403123F188A953E93E2123FF4CAAE3EFEC74E3FA65A5F3F3F763C3FB0BAB93D60AED43D6C8D2D3FE5AC6EBF6B5ACBBE03251B3FC4482F3D61450DBF88A5153DE4982B3F21F7403FF4013DBD61A48F3FC0A4143D8871F33E72D2BABF6898343F08145B3F84F6353F42DD853FFC33D6BEECF747BECB8A0EBF7AFB073F7E83DF3E82F48C3F4675D13E94F7613F8CF9C73E14AC67BE60DE743F53B64D3F8231073FAEF397BF8CD3FC3EB40144BF9E261E3F9DA3303FB41710BE3C43903F5710F9BE9D40363FD7EB823F0677753ED6FA17BE2208203FE7D37D3F0D05573F0455753E5492173F56C8F73EA0D1453F922F233FEDA2C13E9EBF533F83CC1C3F08F7143F8CC32DBE64A0D9BD376A1F3F2E2D8DBFE048003E44731A3F2AB5813F025CB83E0B40B6BECE05A83DE441453E361A323F4909413F4E24803E00F2D139B8E7493FCED1AD3C26BF8CBF760B1EBE419451BE6076253D44834E3F4B6F743F96E1113F884D963F8E10033F7E952A3FD4601E3EBB130C3D4CC89C3FA0E788BE0882543F70C5483FA47D663F1F3A3B3FC06D4A3CE7048F3FA885A93E399C173FFCC7313F63D6F03E5804D5BD004D223C603283BD58ECAF3E6A7078BE213E2A3F6376353F30678E3F4605703EC2EA1E3F70E7783E6AFE423F1846873F12DE603EB34DACBF83B00A3FF6AF353F594F133F3F0964BF6F60843FD5B96FBF6871733F9869BEBC8F5BF53E69BD18BFEC470F3FAEA9D2BDCBACF63EE150373FA0AC72BE018CBF3E4113683E9F1FCF3EC463E53E1AE193BE90558F3E832BCD3E2C2B1EBF8D8CA63F515766BF60B205BF851C623FCB7D003F124615BE82A8103EFE32143FEF25BC3EA65A133FD23B333F3653773F8CE9CA3DE5B99D3FC456213EE0F3393F209ACE3FCB14DCBF49469D3E9E1958BE70C2213FCEA499BE52AE6F3F0CDA733FF8981E3E6840D13EDE665D3FD181883F607A8B3FAE476EBEA7B7603FC799853E4E636E3FD40E4E3E57890C3FEA4E323F1490C7BD29E2053F6018443F2819F2BE9D978F3F20FA163F8F3FDB3E3E584BBEF7F9E4BE24DE23BFFC5B323FB27C9B3FC3F4863E9FCA7F3F30CA723E6820BDBDC0419FBCA2D9C53ED343993F79E8033FCBB5193FF0B11D3DEFED9C3EAD2CA33F16CF223F65F1ECBE32F4443F405B6B3EC06C3EBD3CB61DBE57E2513F490A383F58A95B3F00009EB8C5A4483F3F86863E7EB889BFEE0C4B3F7F26553F3E93813FCA60373E440D55BE043AA73E3EC6563F5B1306BF15F9863F7E5BA43FCC07683E00EBC13CFD85193F57A04C3F34093ABF537E4C3F64C6793E011A763F0050BDBED917CCBEB2887F3EFE9CF23E"> : tensor<256xf32>
    %1 = mhlo.convolution(%arg0, %arg1) dim_numbers = [b, 0, 1, f]x[o, 0, 1, i]->[b, 0, 1, f], window = {stride = [2, 2], pad = [[1, 1], [1, 1]], rhs_dilate = [1, 1]} {batch_group_count = 1 : i64, feature_group_count = 1 : i64} : (tensor<2x28x28x256xf32>, tensor<256x3x3x256xf32>) -> tensor<2x14x14x256xf32>
    %2 = "mhlo.broadcast_in_dim"(%0) {broadcast_dimensions = dense<3> : tensor<1xi64>} : (tensor<256xf32>) -> tensor<2x14x14x256xf32>
    %3 = mhlo.add %1, %2 : tensor<2x14x14x256xf32>
    return %3 : tensor<2x14x14x256xf32>
}

// CHECK: func.func
// CHECK-NEXT: mhlo.constant
// CHECK-NEXT: cat.conv2d_bias
// CHECK-NEXT: return
